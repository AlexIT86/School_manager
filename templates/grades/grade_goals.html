{% extends 'base.html' %}
{% load grade_extras %}

{% block title %}Obiective de note - School Manager{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-1"><i class="fas fa-target me-2 text-success"></i>Obiective de note</h4>
      {% if active_semester %}
      <small class="text-muted">{{ active_semester }} ({{ active_semester.data_inceput|date:'d.m.Y' }} – {{ active_semester.data_sfarsit|date:'d.m.Y' }})</small>
      {% endif %}
    </div>
    <a href="{% url 'grades:goal_create' %}" class="btn btn-success"><i class="fas fa-plus me-1"></i> Obiectiv nou</a>
  </div>

  {% if goals %}
  <div class="row g-3">
    {% for goal in goals %}
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div class="fw-semibold">{{ goal.subject.nume }}</div>
          <div>
            <a href="{% url 'grades:goal_edit' goal.id %}" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i></a>
            <a href="{% url 'grades:goal_delete' goal.id %}" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-6"><small class="text-muted">Media dorită</small><div class="fw-bold">{{ goal.media_dorita|floatformat:2 }}</div></div>
            <div class="col-6"><small class="text-muted">Media curentă</small><div class="fw-bold">{% if goal.subject.media_note %}{{ goal.subject.media_note|floatformat:2 }}{% else %}--{% endif %}</div></div>
          </div>
          {% if not goal.atins %}
          <div class="progress" style="height: 8px;">
            {% with current=goal.subject.media_note|default:0 desired=goal.media_dorita %}
            {% with pct=current|div:desired|mul:100 %}
            <div class="progress-bar bg-success" style="width: {{ pct|floatformat:0 }}%"></div>
            {% endwith %}
            {% endwith %}
          </div>
          <small class="text-muted d-block mt-1">Diferență: {{ goal.diferenta_de_media|floatformat:2 }}</small>
          {% else %}
          <div class="alert alert-success mt-2 mb-0"><i class="fas fa-trophy me-1"></i> Obiectiv atins{% if goal.data_atins %} în {{ goal.data_atins|date:'d.m.Y' }}{% endif %}!</div>
          {% endif %}
          {% if goal.descriere %}
          <hr>
          <div class="small text-muted">{{ goal.descriere }}</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">
    Nu ai încă obiective definite. Click pe „Obiectiv nou” pentru a adăuga primul obiectiv.
  </div>
  {% endif %}
</div>
{% endblock %}


