{% extends 'base.html' %}
{% load static %}

{% block title %}Statistici Teme{% endblock %}

{% block content %}
<div class="container py-4">
  <h4 class="mb-3">Statistici Teme</h4>

  <div class="row g-3">
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">General</div>
        <div class="card-body">
          <ul class="list-unstyled mb-0">
            <li><strong>Total:</strong> {{ general_stats.total }}</li>
            <li><strong>Finalizate:</strong> {{ general_stats.completed }}</li>
            <li><strong>RatÄƒ finalizare:</strong> {{ general_stats.completion_rate|floatformat:1 }}%</li>
            <li><strong>Timp mediu:</strong> {{ general_stats.average_time|default:0|floatformat:0 }} min</li>
            <li><strong>Timp total:</strong> {{ general_stats.total_time|default:0|floatformat:0 }} min</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">Productivitate pe zile</div>
        <div class="card-body">
          <canvas id="weekdayProductivity"></canvas>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card">
        <div class="card-header">Statistici pe materii</div>
        <div class="card-body">
          <canvas id="subjectCompletion"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Productivitate pe zile
  const weekdayMap = ['L', 'Ma', 'Mi', 'J', 'V', 'S', 'D'];
  const wd = JSON.parse('{{ weekday_stats_json|escapejs }}').map(x => ({ label: weekdayMap[parseInt(x.weekday, 10)], value: x.count }));
  new Chart(document.getElementById('weekdayProductivity'), {
    type: 'bar',
    data: { labels: wd.map(x => x.label), datasets: [{ label: 'Teme finalizate', data: wd.map(x => x.value), backgroundColor: '#17a2b8' }]},
    options: { responsive: true, scales: { y: { beginAtZero: true }}}
  });

  // Statistici pe materii
  const subj = JSON.parse('{{ subject_stats_json|escapejs }}');
  new Chart(document.getElementById('subjectCompletion'), {
    type: 'bar',
    data: { labels: subj.map(x => x.subject_name), datasets: [
      { label: 'Total', data: subj.map(x => x.total), backgroundColor: '#6c757d' },
      { label: 'Finalizate', data: subj.map(x => x.completed), backgroundColor: '#28a745' }
    ]},
    options: { responsive: true, scales: { y: { beginAtZero: true }}}
  });
});
</script>
{% endblock %}


